@model IEnumerable<Swift.Core.JobBase>
@using Newtonsoft.Json

@{
    ViewBag.Title = "作业记录";
}

<h2>集群 @ViewBag.ClusterName -> @ViewBag.JobName 作业记录</h2>

<p>
    <a class="btn btn-info" href="javascript:history.back()">返回</a>
</p>
<table class="table table-striped table-hover">
    <tr>
        <th>
            Id
        </th>
        <th>
            创建时间
        </th>
        <th>
            状态
        </th>
        <th>
            任务记录
        </th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Id)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CreateTime)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Status)
            </td>
            <td>
                <div id="taskList_@item.Id" style="display:none">
                    <table class="table table-striped table-hover">
                        <tr>
                            <th>Id</th>
                            <th>成员</th>
                            <th>状态</th>
                        </tr>
                        @{
                            var tasks = item.TaskPlan;
                            foreach (var memberId in tasks.Keys)
                            {
                                var subTasks = tasks[memberId];
                                if (subTasks != null && subTasks.Any())
                                {
                                    foreach (var task in subTasks)
                                    {
                                        <tr>
                                            <td>@task.Id</td>
                                            <td>@memberId</td>
                                            <td>@task.Status</td>
                                        </tr>
                                    }
                                }
                            }
                        }
                    </table>
                </div>
                <a href="#" class="btnShowTasklist" id="btnShowTasklist_@item.Id">查看</a>
            </td>
        </tr>
    }

</table>

<div class="modal fade" id="taskModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="myModalLabel">任务列表</h4>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        $(".btnShowTasklist").on('click', function (e) {
            var tableId = "taskList_" + $(this).attr("id").split('_')[1];
            $("#taskModal .modal-body").html($("#" + tableId).html());
            $('#taskModal').modal({ keyboard: false });
        });
    });
</script>
